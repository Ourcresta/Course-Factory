You are a Senior Security Architect, Backend Engineer,
and Compliance-focused Platform Owner.

Your task is to IMPLEMENT COMPLETE ADMIN SECURITY
for the **Guru (Admin Portal)** of the OurShiksha platform.

This work is NON-NEGOTIABLE.
No feature work is allowed until this is complete.

--------------------------------------------------
üéØ SECURITY OBJECTIVE
--------------------------------------------------
Make Guru a PROTECTED ADMIN-ONLY SYSTEM such that:

‚Ä¢ No unauthenticated user can access admin APIs
‚Ä¢ No unauthorized role can modify academic data
‚Ä¢ All admin actions are traceable
‚Ä¢ Email-based OTP verification is enforced
‚Ä¢ JWT tokens are required for every admin request

--------------------------------------------------
üèõÔ∏è SECURITY MODEL (LOCK THIS)
--------------------------------------------------

‚Ä¢ Authentication: Email + Password + OTP
‚Ä¢ OTP Delivery: Resend Email API
‚Ä¢ Session: JWT (access token)
‚Ä¢ Authorization: Role-based (ADMIN only)
‚Ä¢ Audit: Mandatory for destructive actions

--------------------------------------------------
üë§ ADMIN ACCOUNT RULES
--------------------------------------------------

‚Ä¢ Admins are NOT self-registered
‚Ä¢ Admin accounts are created manually (seed or DB)
‚Ä¢ Admin must verify email via OTP before login is allowed
‚Ä¢ Passwords MUST be hashed (bcrypt)

--------------------------------------------------
üîê AUTHENTICATION FLOW
--------------------------------------------------

STEP 1: Admin Login (Email + Password)
‚Üí Validate credentials
‚Üí If valid, send OTP to admin email via Resend

STEP 2: OTP Verification
‚Üí Admin submits OTP
‚Üí If OTP valid:
   - Issue JWT access token
   - Mark admin as verified for session

STEP 3: Authenticated Session
‚Üí JWT required on ALL admin routes
‚Üí Token expires (e.g., 12h)
‚Üí Refresh or re-login required after expiry

--------------------------------------------------
üì® RESEND OTP IMPLEMENTATION
--------------------------------------------------

Use Resend API for sending OTP emails.

Environment Variables:
RESEND_API_KEY=xxxxx
RESEND_FROM_EMAIL=admin@ourshiksha.ai

OTP Rules:
‚Ä¢ 6-digit numeric OTP
‚Ä¢ Valid for 5 minutes
‚Ä¢ One-time use
‚Ä¢ Max 3 attempts

OTP Email Content (Simple & Formal):
Subject: OurShiksha Admin Verification Code

Body:
Your One-Time Verification Code is: <OTP>
This code is valid for 5 minutes.
Do not share this code with anyone.

--------------------------------------------------
üß± REQUIRED API ENDPOINTS
--------------------------------------------------

AUTH:
POST /api/admin/auth/login
POST /api/admin/auth/verify-otp
POST /api/admin/auth/logout

SECURED ADMIN ROUTES (ALL MUST BE PROTECTED):
POST   /api/admin/course
PUT    /api/admin/course/:id
DELETE /api/admin/course/:id
POST   /api/admin/course/pricing
POST   /api/admin/certificate/rules
POST   /api/admin/project
POST   /api/admin/test

--------------------------------------------------
üõ°Ô∏è MIDDLEWARE (MANDATORY)
--------------------------------------------------

Implement:

1. requireAuth
   - Validate JWT
   - Reject missing/expired tokens

2. requireAdmin
   - role === "ADMIN"
   - Reject all others

3. rateLimiter
   - Protect auth routes
   - Prevent OTP brute force

4. auditLogger
   - Log ALL create/update/delete actions

--------------------------------------------------
üßæ AUDIT LOGGING (NON-OPTIONAL)
--------------------------------------------------

Create table: admin_audit_logs

Fields:
‚Ä¢ id
‚Ä¢ admin_id
‚Ä¢ action_type (CREATE / UPDATE / DELETE)
‚Ä¢ entity_type (COURSE / CERTIFICATE / PRICING)
‚Ä¢ entity_id
‚Ä¢ timestamp
‚Ä¢ ip_address

Audit logs must be written automatically
on every destructive admin action.

--------------------------------------------------
üö´ ABSOLUTE SECURITY RULES
--------------------------------------------------

DO NOT:
‚úó Allow admin routes without JWT
‚úó Allow wildcard CORS
‚úó Trust frontend role claims
‚úó Store OTP in plaintext
‚úó Log sensitive secrets
‚úó Allow student access to admin APIs

--------------------------------------------------
üåê CORS & ORIGIN CONTROL
--------------------------------------------------

Allow ONLY:
‚Ä¢ https://guru.ourshiksha.ai (Admin UI)
‚Ä¢ https://shishya.ourshiksha.ai (Read-only APIs)

Reject all other origins.

--------------------------------------------------
üß™ SECURITY TEST CASES (MUST PASS)
--------------------------------------------------

‚úî Admin cannot access without login
‚úî OTP required on first login
‚úî Wrong OTP fails
‚úî Expired OTP fails
‚úî JWT required on every admin route
‚úî Student token rejected
‚úî API rejects unauthenticated requests
‚úî Audit log created on data changes

--------------------------------------------------
üì¶ FINAL DELIVERABLES
--------------------------------------------------

1. Secure admin login flow
2. OTP via Resend
3. JWT auth middleware
4. Role-based route protection
5. Audit logging system
6. Security documentation

--------------------------------------------------
üö® FINAL DECLARATION RULE
--------------------------------------------------

ONLY after ALL above are implemented
may the verdict change from:

NO-GO ‚Üí GO

This security layer is the FOUNDATION
of academic trust for OurShiksha.

Proceed step-by-step.
Do NOT skip validation.
